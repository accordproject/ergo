<!DOCTYPE html>

<style>
body {
    background: white;
    color: black;
    padding-left:  3em;
    padding-right: 3em;
    font-family: Georgia;
}
h1 {
    font-variant: small-caps;
    letter-spacing: 1em;
    text-align: center;
    color: pink;
    font-weight: 100;
}
textarea {
    width: 100%;
    font-family: monospace;
    font-size: 1em;
    border: none;
    background: #eee;
    padding: 0.5em;
    border-radius: 0.2em;
}
textarea:focus {
    outline: none;
    background: white;
}
pre {
    padding-left: 0.5em;
    white-space: pre-wrap;
}

span.emit     { color: hotpink; }
span.failure  { color: red; }
span.state    { color: blue; }
span.response { color: green; }

</style>

<h1>ergotop</h1>
<pre id="stdout"></pre>
<textarea autofocus type="text" id="stdin" placeholder="return 42;" rows=5></textarea>
<button onclick="update()">Evaluate [&#x21EA; &#x21B5;]</button>
<a href="https://docs.accordproject.org/docs/ergo.html" target="_blank">
  <button>What is this?</button>
</a>

<script src="./lib/ergotop.js"></script>
<script>
var ctx = ergotop.initRCtxt;

var stdin  = document.getElementById('stdin');
var stdout = document.getElementById('stdout');

stdin.addEventListener('keydown', function(evt) {
    if (evt.keyCode === 9) {
        evt.preventDefault();
    }
    if (evt.keyCode === 13 && evt.shiftKey) {
        evt.preventDefault();
        update();
    }
}, false);

function update() {
    var x = ergotop.runLine(ctx, stdin.value);
    if (x) {
        ctx = x.ctx;
        stdout.innerHTML += "<strong>" + stdin.value.replace(/</g, "&lt;") + "</strong>" + "\n";
        stdout.innerHTML +=
            x.out
            .replace(/</g, "&lt;")
//          .replace(/Unit/g, 'ðŸŒ¯')
            .replace(/^Response\./gm, '<span class="response">Response.</span>')
            .replace(/^Emit\./gm, '<span class="emit">Emit.</span>')
            .replace(/^Failure\./gm, '<span class="failure">Failure.</span>')
            .replace(/^State\./gm, '<span class="state">State.</span>')
        stdin.value = "";
    }
}
</script>
